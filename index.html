<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶£å‘³å†™å­—è¯¾ - AI ç¬”ç”»è€å¸ˆ</title>
    <!-- å¼•å…¥ Hanzi Writer ç”¨äºç¬”ç”»åŠ¨ç”» -->
    <script src="https://gcore.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <!-- å¼•å…¥ pinyin-pro ç”¨äºè·å–æ‹¼éŸ³ -->
    <script src="https://gcore.jsdelivr.net/npm/pinyin-pro@3.20.1/dist/index.js"></script>
    
    <style>
        :root {
            --bg-color: #FFF9E6; /* æŸ”å’Œçš„ç±³é»„åº•è‰² */
            --primary-color: #FF6B6B; /* æ˜äº®çš„çº¢è‰² */
            --secondary-color: #4ECDC4; /* æ´»æ³¼çš„é’è‰² */
            --text-color: #333;
            --grid-border: #FF9F43;
        }

        body {
            font-family: "Microsoft YaHei", "Heiti SC", sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            text-shadow: 2px 2px 0px #ffe66d;
            margin-bottom: 10px;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        input {
            padding: 10px 20px;
            font-size: 1.5rem;
            border: 3px solid var(--secondary-color);
            border-radius: 15px;
            width: 100px;
            text-align: center;
            outline: none;
            color: var(--text-color);
        }

        input:focus {
            border-color: var(--primary-color);
        }

        button {
            padding: 10px 25px;
            font-size: 1.2rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s;
            box-shadow: 0 4px 0 #d44646;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* æ‹¼éŸ³æ˜¾ç¤º */
        .pinyin-display {
            font-size: 2.5rem;
            color: var(--secondary-color);
            font-weight: bold;
            height: 60px; /* å ä½é˜²æ­¢è·³åŠ¨ */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        /* ç¬”ç”»ä¿¡æ¯ */
        .stroke-info {
            color: #888;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .stroke-count {
            color: var(--primary-color);
            font-weight: bold;
        }

        /* ç”°å­—æ ¼å®¹å™¨ */
        .tian-zi-ge {
            width: min(80vw, 300px);
            height: min(80vw, 300px);
            margin: 0 auto;
            position: relative;
            background-color: #fff;
            border: 4px solid var(--grid-border);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
            /* ä½¿ç”¨ CSS ç»˜åˆ¶ç”°å­—æ ¼å†…éƒ¨è™šçº¿ */
            background-image:
                linear-gradient(to right, transparent 49.5%, var(--grid-border) 49.5%, var(--grid-border) 50.5%, transparent 50.5%),
                linear-gradient(to bottom, transparent 49.5%, var(--grid-border) 49.5%, var(--grid-border) 50.5%, transparent 50.5%);
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
                margin-bottom: 5px;
            }
            .container { padding: 20px; }
            .pinyin-display { font-size: 2rem; height: 50px; }
            input {
                font-size: 1.8rem;
                width: 80px;
                min-height: 44px;
            }
            button {
                min-height: 44px;
                padding: 10px 20px;
                font-size: 1.1rem;
            }
        }

        /* è™šçº¿æ ·å¼ä¼˜åŒ– */
        .tian-zi-ge::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(45deg, transparent 49%, #ffe0b2 49%, #ffe0b2 51%, transparent 51%),
                linear-gradient(-45deg, transparent 49%, #ffe0b2 49%, #ffe0b2 51%, transparent 51%);
            opacity: 0.3;
            pointer-events: none;
            z-index: 0;
        }

        #character-target {
            position: relative;
            z-index: 10;
        }

        /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            box-shadow: 0 4px 0 #2a9d8f;
        }

        .message {
            margin-top: 15px;
            color: #888;
            font-size: 0.9rem;
        }

        /* å¸¸ç”¨æ±‰å­—é¢æ¿ */
        .char-panel {
            margin-top: 25px;
            border-top: 2px dashed #eee;
            padding-top: 20px;
        }

        .panel-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-weight: bold;
        }

        .category-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .category-tab {
            padding: 6px 12px;
            font-size: 0.9rem;
            background-color: #f0f0f0;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-tab.active {
            background-color: var(--secondary-color);
            color: white;
        }

        .char-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 5px;
        }

        .char-btn {
            aspect-ratio: 1;
            font-size: 1.5rem;
            background-color: #ffffff;
            border: 2px solid #bdbdbd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
        }

        .char-btn:hover {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
            transform: scale(1.1);
        }

        .char-btn:active {
            transform: scale(0.95);
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 600px) {
            .char-grid {
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
                gap: 6px;
            }
            .char-btn {
                font-size: 1.3rem;
            }
        }

        /* åº†ç¥åŠ¨ç”» */
        @keyframes celebration {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes starBurst {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: scale(2) rotate(180deg);
                opacity: 0;
            }
        }

        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .celebration-emoji {
            position: absolute;
            font-size: 3rem;
            animation: celebration 1s ease-out forwards;
        }

        .star {
            position: absolute;
            color: #FFD700;
            font-size: 2rem;
            animation: starBurst 1.5s ease-out forwards;
        }

    </style>
</head>
<body>

    <!-- åº†ç¥åŠ¨ç”»è¦†ç›–å±‚ -->
    <div class="celebration-overlay" id="celebrationOverlay"></div>

    <h1>âœï¸ æ±‰å­—é­”æ³•è¯¾å ‚</h1>

    <div class="container">
        <div class="input-group">
            <input type="text" id="charInput" maxlength="1" placeholder="è¾“" value="çˆ±">
            <button onclick="loadCharacter()">å¼€å§‹å­¦ä¹ </button>
        </div>

        <div class="pinyin-display" id="pinyin">Ã i</div>

        <div class="stroke-info">
            ç¬”ç”»æ•°ï¼š<span class="stroke-count" id="strokeCount">-</span>
        </div>

        <div class="tian-zi-ge">
            <div id="character-target"></div>
        </div>

        <div class="controls">
            <button class="btn-secondary" onclick="watchStroke()">ğŸ‘€ è§‚çœ‹ç¬”é¡º</button>
            <button class="btn-secondary" onclick="animateStroke()">âœï¸ è·Ÿç€ç»ƒä¹ </button>
            <button class="btn-secondary" onclick="speak()">ğŸ”Š è¯»ç»™æˆ‘å¬</button>
        </div>
        
        <div class="message" id="statusMsg">è¾“å…¥ä¸€ä¸ªæ±‰å­—ï¼Œè®© AI è€å¸ˆæ•™ä½ å†™ï¼</div>

        <!-- å¸¸ç”¨æ±‰å­—é€‰æ‹©é¢æ¿ -->
        <div class="char-panel">
            <div class="panel-title">ğŸ“š å¸¸ç”¨æ±‰å­—</div>
            <div class="category-tabs">
                <button class="category-tab active" data-category="grade1">ä¸€å¹´çº§</button>
                <button class="category-tab" data-category="grade2">äºŒå¹´çº§</button>
                <button class="category-tab" data-category="grade3">ä¸‰å¹´çº§</button>
                <button class="category-tab" data-category="numbers">æ•°å­—</button>
                <button class="category-tab" data-category="animals">åŠ¨ç‰©</button>
                <button class="category-tab" data-category="plants">æ¤ç‰©</button>
                <button class="category-tab" data-category="nature">è‡ªç„¶</button>
                <button class="category-tab" data-category="family">å®¶äºº</button>
                <button class="category-tab" data-category="colors">é¢œè‰²</button>
            </div>
            <div class="char-grid" id="charGrid">
                <!-- æ±‰å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        let writer = null;
        const { pinyin } = pinyinPro;

        // å¸¸ç”¨æ±‰å­—æ•°æ®
        const commonChars = {
            grade1: ['ä¸€', 'äºŒ', 'ä¸‰', 'å', 'äºº', 'å¤§', 'å°', 'å±±', 'æ°´', 'ç«', 'åœŸ', 'æœ¨', 'å¤©', 'åœ°', 'æ—¥', 'æœˆ', 'ç™½', 'äº‘', 'é£', 'é›¨', 'ä¸Š', 'ä¸‹', 'ä¸­', 'å·¦', 'å³', 'ä¸œ', 'è¥¿', 'å—', 'åŒ—', 'å£', 'è€³', 'ç›®', 'æ‰‹', 'è¶³', 'å¿ƒ', 'é©¬', 'ç‰›', 'ç¾Š', 'é±¼', 'é¸Ÿ', 'è™«', 'äº†', 'å­', 'å¥³', 'å¥½', 'å­¦', 'ç”Ÿ', 'è€', 'å¸ˆ', 'ä¹¦', 'æœ¬', 'å†™', 'å­—', 'è¯»', 'ç”»', 'èŠ±', 'æ ‘', 'å¶', 'çº¢', 'ç»¿', 'é»„', 'è“', 'å®¶', 'çˆ¸', 'å¦ˆ', 'æˆ‘', 'ä½ ', 'ä»–', 'ä»¬', 'åœ¨', 'å»', 'æ¥', 'å‡º', 'å…¥', 'å¼€', 'å…³', 'å‰', 'å', 'é•¿', 'çŸ­', 'æ–¹', 'åœ†', 'å¤š', 'å°‘', 'æœ‰', 'æ²¡', 'æ˜¯', 'çš„', 'å—'],
            grade2: ['è½¦', 'é£', 'æ¥', 'å»', 'å­¦', 'æ ¡', 'è€', 'å¸ˆ', 'è¯­', 'æ–‡', 'æ•°', 'æ˜', 'è¯­', 'æ–‡', 'æ•°', 'å­¦', 'éŸ³', 'ä¹', 'ä½“', 'è‚²', 'ç¾', 'æœ¯', 'ç§‘', 'å­¦', 'ä¹¦', 'åŒ…', 'é“…', 'ç¬”', 'æ©¡', 'çš®', 'å°º', 'å­', 'ä½œ', 'ä¸š', 'è¯¾', 'æ¡Œ', 'æ¤…', 'å­', 'é»‘', 'æ¿', 'æœ‹', 'å‹', 'åŒ', 'å‹', 'ç©', 'å…·', 'æ¸¸', 'æˆ', 'æ“', 'åœº', 'èŠ±', 'å›­', 'è‰', 'åœ°', 'æ ‘', 'æ—', 'æ²³', 'æµ', 'æ¹–', 'æ³Š', 'æµ·', 'æ´‹', 'æ²™', 'æ¼ ', 'å±±', 'å³°', 'è°·', 'åº•', 'ç”°', 'é‡', 'åŸ', 'å¸‚', 'å†œ', 'æ‘', 'å›½', 'å®¶', 'ä¸–', 'ç•Œ', 'å®‡', 'å®™'],
            grade3: ['æ˜¥', 'å¤', 'ç§‹', 'å†¬', 'å­£', 'èŠ‚', 'èŠ‚', 'æ°”', 'å¯’', 'å†·', 'ç‚', 'çƒ­', 'æ¸©', 'æš–', 'å‡‰', 'çˆ½', 'æ™´', 'æœ—', 'é˜´', 'æ²‰', 'ä¸‹', 'é›¨', 'ä¸‹', 'é›ª', 'å†°', 'é›¹', 'éœœ', 'å†»', 'é›¾', 'éœ¾', 'éœ²', 'ç ', 'é£', 'æš´', 'å°', 'é£', 'é¾™', 'å·', 'å†°', 'é›ª', 'ç§¯', 'é›ª', 'è', 'åŒ–', 'è’¸', 'å‘', 'å†·', 'å‡', 'é™', 'æ°´', 'æ²³', 'æµ', 'æ±Ÿ', 'æ²³', 'æ¹–', 'æ³Š', 'æ°´', 'åº“', 'æµ·', 'æ´‹', 'æµ·', 'å²›', 'æµ·', 'æ»©', 'æ½®', 'æ±', 'æ³¢', 'æµª', 'æµª', 'èŠ±', 'æµ·', 'å•¸', 'æ´ª', 'æ°´', 'å¹²', 'æ—±', 'ç¾', 'å®³'],
            numbers: ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å', 'ç™¾', 'åƒ', 'ä¸‡', 'é›¶', 'ä¸¤', 'åŒ', 'åŠ', 'æ»¡', 'ç©º', 'å…¨', 'ç¬¬', 'åˆ', 'æ­£', 'è´Ÿ', 'åŠ ', 'å‡', 'ä¹˜', 'é™¤', 'ç­‰', 'äº', 'å¤§', 'å°', 'å¤š', 'å°‘', 'é«˜', 'ä½', 'é•¿', 'çŸ­', 'å®½', 'çª„', 'åš', 'è–„', 'é‡', 'è½»', 'ç²—', 'ç»†', 'æ–¹', 'åœ†', 'ç›´', 'å¼¯', 'å°–', 'ç§ƒ', 'æ‰', 'é¼“', 'å‡¹', 'å‡¸'],
            animals: ['é©¬', 'ç‰›', 'ç¾Š', 'çŒª', 'ç‹—', 'çŒ«', 'å…”', 'é¸Ÿ', 'é±¼', 'è™«', 'é¸¡', 'é¸­', 'é¹…', 'è™', 'ç‹®', 'è±¡', 'ç†Š', 'çŒ´', 'é¼ ', 'è›‡', 'é¾Ÿ', 'è™¾', 'èŸ¹', 'é¹¿', 'ç‹¼', 'ç‹', 'ç‹¸', 'è±¹', 'çŠ€', 'æ²³', 'é©¬', 'é³„', 'é±¼', 'é²¸', 'è±š', 'è™', 'è ', 'è´', 'è¶', 'èœœ', 'èœ‚', 'èœ»', 'èœ“', 'èš‚', 'èš', 'èœ˜', 'è››', 'èœˆ', 'èš£', 'èš¯', 'èš“', 'èŒ', 'èšª', 'é’', 'è›™', 'ä¹Œ', 'é¾Ÿ', 'ç”°', 'é¸¡', 'èŸ‹', 'èŸ€', 'è—', 'è™«', 'ç“¢', 'è™«', 'çŸ¥', 'äº†', 'è´', 'è¶', 'å­”', 'é›€', 'é¹¦', 'é¹‰', 'é¸µ', 'é¸Ÿ', 'ä¼', 'é¹…', 'çŒ«', 'å¤´', 'é¹°', 'ä¸¹', 'é¡¶', 'é¹¤', 'æ¾', 'é¼ ', 'åˆº', 'çŒ¬'],
            plants: ['èŠ±', 'è‰', 'æ ‘', 'æœ¨', 'å¶', 'æœ', 'æ ¹', 'èŒ', 'æ', 'æ¡', 'æ ‘', 'å¹²', 'æ ‘', 'çš®', 'æ ‘', 'å¶', 'æ ‘', 'æ', 'æ ‘', 'æ ¹', 'æ ‘', 'è‹—', 'æ ‘', 'æ—', 'æ£®', 'æ—', 'ç«¹', 'æ—', 'æœ', 'å›­', 'èŠ±', 'å›­', 'èœ', 'å›­', 'è‰', 'åœ°', 'è‰', 'åª', 'è‰', 'åŸ', 'è‰', 'è“', 'è²', 'èŠ±', 'è·', 'èŠ±', 'èŠ', 'èŠ±', 'æ¢…', 'èŠ±', 'æ¡‚', 'èŠ±', 'å…°', 'èŠ±', 'ç‰¡', 'ä¸¹', 'ç«', 'ç‘°', 'æœˆ', 'å­£', 'è‘µ', 'èŠ±', 'ç‰µ', 'ç‰›', 'èŠ±', 'å‘', 'æ—¥', 'è‘µ', 'æ¡ƒ', 'èŠ±', 'æ', 'èŠ±', 'æ¢¨', 'èŠ±', 'è‹¹', 'æœ', 'æ¡ƒ', 'å­', 'æ', 'å­', 'æ¢¨', 'å­', 'æ©˜', 'å­', 'æŸš', 'å­', 'æŸ¿', 'å­', 'æ£', 'å­', 'æ —', 'å­', 'æ ¸', 'æ¡ƒ', 'èŠ±', 'ç”Ÿ', 'è‘µ', 'èŠ±', 'ç±½'],
            nature: ['å±±', 'æ°´', 'ç«', 'åœŸ', 'çŸ³', 'ç”°', 'å¤©', 'åœ°', 'æ—¥', 'æœˆ', 'æ˜Ÿ', 'äº‘', 'é£', 'é›¨', 'é›ª', 'å†°', 'é›·', 'ç”µ', 'å¤©', 'åœ°', 'æ˜¥', 'å¤', 'ç§‹', 'å†¬', 'èŠ±', 'è‰', 'æ ‘', 'æœ¨', 'å¶', 'æœ', 'æ±Ÿ', 'æ²³', 'æ¹–', 'æµ·', 'æ± ', 'æ³‰', 'æ²™', 'å°˜', 'æ³¥', 'åœŸ', 'é›¨', 'éœ²', 'éœœ', 'é›¾', 'çƒŸ', 'éœ', 'éœ²', 'ç ', 'äº‘', 'å½©', 'å½©', 'è™¹', 'æ—¥', 'æœˆ', 'æ˜Ÿ', 'è¾°', 'å¤©', 'ç©º', 'å¤©', 'æ°”', 'æ°”', 'è±¡', 'åœ°', 'éœ‡', 'ç«', 'å±±', 'é£“', 'é£', 'é¾™', 'å·', 'é£', 'å†°', 'é›¹', 'é›ª', 'å´©', 'æ³¥', 'çŸ³', 'æµ', 'æ´ª', 'æ°´', 'å¹²', 'æ—±', 'æ²™', 'å°˜', 'æš´', 'é›¾', 'éœ¾', 'é…¸', 'é›¨', 'æ¸©', 'å®¤', 'æ•ˆ', 'åº”'],
            family: ['çˆ¸', 'å¦ˆ', 'çˆ¶', 'æ¯', 'çˆ·', 'å¥¶', 'çˆ·', 'å…¬', 'å©†', 'å§¥', 'å”', 'ä¼¯', 'å§‘', 'å§¨', 'èˆ…', 'å“¥', 'å§', 'å¼Ÿ', 'å¦¹', 'æˆ‘', 'ä½ ', 'ä»–', 'ä»¬', 'å®¶', 'äºº', 'å„¿', 'å¥³', 'å­©', 'å­', 'äº²', 'çˆ±', 'çš„', 'å®¶', 'ç¥–', 'çˆ¶', 'ç¥–', 'æ¯', 'å¤–', 'ç¥–', 'çˆ¶', 'å¤–', 'ç¥–', 'æ¯', 'æ›¾', 'ç¥–', 'çˆ¶', 'æ›¾', 'ç¥–', 'æ¯', 'è¡¨', 'å“¥', 'è¡¨', 'å§', 'å ‚', 'å“¥', 'å ‚', 'å§', 'ä¾„', 'å­', 'ä¾„', 'å¥³', 'å¤–', 'ç”¥', 'å¤–', 'ç”¥', 'å¥³', 'å­™', 'å­', 'å­™', 'å¥³', 'ä¸ˆ', 'å¤«', 'å¦»', 'å­', 'è€', 'å…¬', 'è€', 'å©†', 'ç”·', 'æœ‹', 'å‹', 'å¥³', 'æœ‹', 'å‹', 'æ‹', 'äºº', 'çˆ±', 'äºº', 'å®¶', 'åº­', 'å®¶', 'æ—', 'äº²', 'äºº', 'äº²', 'æˆš', 'è¡€', 'ç¼˜', 'å…³', 'ç³»'],
            colors: ['çº¢', 'ç»¿', 'é»„', 'è“', 'é»‘', 'ç™½', 'ç°', 'ç´«', 'ç²‰', 'æ©™', 'æ£•', 'é’', 'è“', 'ç»¿', 'é»„', 'é‡‘', 'é“¶', 'å½©', 'è‰²', 'æ·±', 'æµ…', 'äº®', 'æš—', 'é²œ', 'è‰³', 'æ·¡', 'é›…', 'ç´ ', 'å‡€', 'èŠ±', 'å“¨', 'æ–‘', 'æ–“', 'ç»š', 'ä¸½', 'ç’€', 'ç’¨', 'å¤º', 'ç›®', 'è€€', 'çœ¼', 'æŸ”', 'å’Œ', 'æ¸©', 'æš–', 'å†·', 'é…·', 'ç«', 'çƒ­', 'å†°', 'å†·', 'ç«', 'çº¢', 'æ¡ƒ', 'çº¢', 'ç²‰', 'çº¢', 'æœ±', 'çº¢', 'è¡€', 'çº¢', 'æ©™', 'çº¢', 'æ£', 'çº¢', 'å¤§', 'çº¢', 'é‡‘', 'é»„', 'æ©™', 'é»„', 'é¹…', 'é»„', 'ç±³', 'é»„', 'åœŸ', 'é»„', 'å«©', 'é»„', 'ç¿ ', 'ç»¿', 'å¢¨', 'ç»¿', 'è‰', 'ç»¿', 'æ·¡', 'ç»¿', 'é’', 'ç»¿', 'ç¢§', 'ç»¿', 'ç‰', 'ç»¿', 'å«©', 'ç»¿', 'æ·±', 'è“', 'æµ…', 'è“', 'å¤©', 'è“', 'æµ·', 'è“', 'æ·¡', 'è“', 'é›', 'è“', 'é’´', 'è“']
        };

        // åˆå§‹åŒ–åŠ è½½
        window.onload = () => {
            loadCharacter();
            renderCharGrid('grade1'); // é»˜è®¤æ˜¾ç¤ºä¸€å¹´çº§æ±‰å­—
            setupCategoryTabs();
        };

        // æ ¸å¿ƒå‡½æ•°ï¼šåŠ è½½æ±‰å­—
        function loadCharacter() {
            const char = document.getElementById('charInput').value;
            const targetDiv = document.getElementById('character-target');
            const pinyinDiv = document.getElementById('pinyin');
            const statusMsg = document.getElementById('statusMsg');

            // ç®€å•éªŒè¯
            if (!char || !/[\u4e00-\u9fa5]/.test(char)) {
                statusMsg.innerText = "è¯·å…ˆè¾“å…¥ä¸€ä¸ªä¸­æ–‡æ±‰å­—å“¦ï¼";
                statusMsg.style.color = "red";
                playSound('error');
                return;
            }
            statusMsg.innerText = "åŠ è½½ä¸­...";
            statusMsg.style.color = "#888";

            // 1. æ¸…ç©ºæ—§çš„
            targetDiv.innerHTML = '';

            // 2. è·å–æ‹¼éŸ³
            const pinyinText = pinyin(char, { toneType: 'symbol' }); // å¸¦å£°è°ƒçš„æ‹¼éŸ³
            pinyinDiv.innerText = pinyinText;

            // 3. åˆå§‹åŒ– Hanzi Writer (åˆå§‹çŠ¶æ€ï¼Œä¸è‡ªåŠ¨å¼€å§‹åŠ¨ç”»æˆ–ç»ƒä¹ )
            // è¿™é‡Œä½¿ç”¨äº† CDN åŠ è½½ç¬”ç”»æ•°æ®ï¼Œéœ€è¦è”ç½‘
            writer = HanziWriter.create('character-target', char, {
                width: 300,
                height: 300,
                padding: 20,
                strokeColor: '#333', // ç¬”ç”»é¢œè‰²
                highlightColor: '#4ECDC4', // å½“å‰ç¬”é¢œè‰²ï¼ˆå¢å¼ºæ•™å­¦æ•ˆæœï¼‰
                radicalColor: '#FF6B6B', // éƒ¨é¦–é¢œè‰²ï¼ˆé«˜äº®æ˜¾ç¤ºï¼Œé€‚åˆæ•™å­¦ï¼‰
                showOutline: true, // æ˜¾ç¤ºè½®å»“åº•çº¹
                outlineColor: '#DDD',
                strokeAnimationSpeed: 0.5, // åŠ¨ç”»é€Ÿåº¦æ…¢ä¸€ç‚¹ï¼Œé€‚åˆå­©å­
                delayBetweenStrokes: 800, // æ¯ä¸€ç¬”åœé¡¿æ—¶é—´ï¼ˆå¢åŠ åˆ°800msï¼‰
            });

            // è·å–å¹¶æ˜¾ç¤ºç¬”ç”»æ•°
            writer.getCharacterData().then(data => {
                if (data && data.strokes) {
                    document.getElementById('strokeCount').innerText =
                        `${data.strokes.length} ç¬”`;
                }
            });

            // æ˜¾ç¤ºå°±ç»ªçŠ¶æ€
            statusMsg.innerText = "æ±‰å­—å·²åŠ è½½ï¼è¯·é€‰æ‹©ï¼šè§‚çœ‹ç¬”é¡º æˆ– è·Ÿç€ç»ƒä¹ ";
            statusMsg.style.color = "#4ECDC4";
            playSound('success');
        }

        // è§‚çœ‹ç¬”é¡ºï¼ˆçº¯åŠ¨ç”»æ¼”ç¤ºï¼‰
        function watchStroke() {
            if(writer) {
                statusMsg.innerText = "æ­£åœ¨æ¼”ç¤ºç¬”é¡ºï¼Œè¯·ä»”ç»†è§‚å¯Ÿ...";
                statusMsg.style.color = "#4ECDC4";
                writer.animateCharacter();
                playSound('click');
            }
        }

        // è·Ÿç€ç»ƒä¹ ï¼ˆåŠ¨ç”»æ¼”ç¤ºåè¿›å…¥ç»ƒä¹ æ¨¡å¼ï¼‰
        function animateStroke() {
            if(writer) {
                statusMsg.innerText = "å…ˆè§‚çœ‹ä¸€éï¼Œç„¶åè·Ÿç€ç»ƒä¹ ...";
                statusMsg.style.color = "#4ECDC4";
                writer.animateCharacter();
                playSound('click');

                // åŠ¨ç”»ç»“æŸåè‡ªåŠ¨è¿›å…¥ç»ƒä¹ æ¨¡å¼
                setTimeout(() => {
                    if (writer) {
                        statusMsg.innerText = "ç°åœ¨å¼€å§‹è·Ÿç€ç»ƒä¹ å§ï¼";
                        writer.quiz({
                            onComplete: function(summaryData) {
                                statusMsg.innerText = "å¤ªæ£’äº†ï¼ä½ å­¦ä¼šäº†ï¼";
                                statusMsg.style.color = "#FF6B6B";
                                playSound('complete');
                                showCelebration();
                            }
                        });
                    }
                }, 3000);
            } else {
                statusMsg.innerText = "è¯·å…ˆè¾“å…¥ä¸€ä¸ªæ±‰å­—ï¼";
                statusMsg.style.color = "red";
                playSound('error');
            }
        }

        // è¯­éŸ³æœ—è¯» (æµè§ˆå™¨åŸç”Ÿ API - ä¿®å¤æ‰‹æœºå‘éŸ³é—®é¢˜)
        let availableVoices = [];

        // æ£€æµ‹å¹¶å¤„ç†ç§»åŠ¨è®¾å¤‡è¯­éŸ³é—®é¢˜
        function checkMobileVoiceSupport() {
            const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
            if (!isMobile) return true;

            const chineseVoices = availableVoices.filter(voice =>
                voice.lang && (voice.lang.includes('zh') || voice.lang.includes('cmn') || voice.lang.includes('Chinese'))
            );

            if (chineseVoices.length === 0) {
                console.error("âŒ ç§»åŠ¨è®¾å¤‡ç¼ºå°‘ä¸­æ–‡TTSè¯­éŸ³åŒ…ï¼");

                // å‘ç”¨æˆ·å±•ç¤ºè§£å†³æ–¹æ¡ˆ
                const mobileFixDiv = document.createElement('div');
                mobileFixDiv.id = 'mobileVoiceFix';
                mobileFixDiv.style.cssText = `
                    background: #fff3cd;
                    border: 2px solid #ffc107;
                    border-radius: 10px;
                    padding: 15px;
                    margin: 15px 0;
                    text-align: left;
                    color: #856404;
                    font-size: 0.9rem;
                `;
                mobileFixDiv.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“± æ£€æµ‹åˆ°è¯­éŸ³é—®é¢˜</div>
                    <div>æ‚¨çš„æ‰‹æœºå¯èƒ½æœªå®‰è£…ä¸­æ–‡è¯­éŸ³åŒ…ï¼Œå¯¼è‡´åªèƒ½å‘å‡ºéŸ³èŠ‚å£°ï¼ˆå˜Ÿ/æ»´ç­‰ï¼‰ã€‚</div>
                    <div style="margin-top: 8px; font-weight: bold;">è§£å†³æ–¹æ¡ˆï¼š</div>
                    <ul style="margin: 5px 0; padding-left: 20px;">
                        <li>Androidï¼šä¸‹è½½Googleæ–‡å­—è½¬è¯­éŸ³ + ä¸­æ–‡è¯­éŸ³åŒ…</li>
                        <li>iOSï¼šæ£€æŸ¥"è®¾ç½® > è¾…åŠ©åŠŸèƒ½ > æœ—è¯»å†…å®¹"æ˜¯å¦å¼€å¯</li>
                        <li>ä½¿ç”¨Chromeæµè§ˆå™¨ï¼ˆå…¼å®¹æ€§æœ€å¥½ï¼‰</li>
                        <li>ç¡®ä¿ç³»ç»Ÿè¯­è¨€åŒ…å«ä¸­æ–‡</li>
                    </ul>
                    <div style="margin-top: 8px; font-size: 0.8rem; color: #666;">
                        å½“å‰å¯ç”¨è¯­éŸ³ï¼š${availableVoices.length ? availableVoices.map(v => v.name).join(', ') : 'æ— '}
                    </div>
                `;

                document.querySelector('.container').appendChild(mobileFixDiv);
                return false;
            }
            return true;
        }

        // é¢„åŠ è½½å¹¶ç¼“å­˜è¯­éŸ³åˆ—è¡¨
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = function() {
                availableVoices = speechSynthesis.getVoices();
                console.log("Available voices:", availableVoices.length);

                // æŸ¥æ‰¾ä¸­æ–‡è¯­éŸ³
                const chineseVoices = availableVoices.filter(voice =>
                    voice.lang && (voice.lang.includes('zh') || voice.lang.includes('cmn') || voice.lang.includes('Chinese'))
                );

                if (chineseVoices.length === 0) {
                    console.warn("è­¦å‘Šï¼šæœªæ‰¾åˆ°ä¸­æ–‡è¯­éŸ³åŒ…ï¼æ‰‹æœºå¯èƒ½ä¸æ”¯æŒä¸­æ–‡æœ—è¯»");
                    console.warn("å¯ç”¨è¯­éŸ³:", availableVoices.map(v => `${v.name} (${v.lang})`).join(', '));
                } else {
                    console.log("æ‰¾åˆ°ä¸­æ–‡è¯­éŸ³:", chineseVoices.map(v => `${v.name} (${v.lang})`).join(', '));
                }
            };

            // ç«‹å³è§¦å‘ä¸€æ¬¡åŠ è½½
            availableVoices = speechSynthesis.getVoices();
        }

        function speak() {
            const char = document.getElementById('charInput').value;
            const statusMsg = document.getElementById('statusMsg');

            // æ£€æŸ¥æ˜¯å¦æ”¯æŒè¯­éŸ³åˆæˆ
            if (!('speechSynthesis' in window)) {
                statusMsg.innerText = "âŒ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æ’­æ”¾åŠŸèƒ½";
                statusMsg.style.color = "red";
                playSound('error');
                return;
            }

            // åœæ­¢ä¹‹å‰çš„æ’­æ”¾
            speechSynthesis.cancel();

            // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨è¯­éŸ³
            if (availableVoices.length === 0) {
                availableVoices = speechSynthesis.getVoices();
            }

            const chineseVoices = availableVoices.filter(voice =>
                voice.lang && (voice.lang.includes('zh') || voice.lang.includes('cmn') || voice.lang.includes('Chinese'))
            );

            // **å…³é”®ï¼šå¦‚æœæ²¡æœ‰ä¸­æ–‡è¯­éŸ³ï¼Œç›´æ¥æç¤ºç”¨æˆ·**
            if (chineseVoices.length === 0) {
                console.error("âŒ ä¸¥é‡é”™è¯¯ï¼šå®Œå…¨æ‰¾ä¸åˆ°ä¸­æ–‡è¯­éŸ³ï¼");
                console.error("å¯ç”¨è¯­éŸ³:", availableVoices.map(v => `${v.name} (${v.lang})`).join(', '));

                // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
                statusMsg.innerHTML = `
                    <div>âŒ æ‚¨çš„è®¾å¤‡ç¼ºå°‘ä¸­æ–‡è¯­éŸ³åŒ…</div>
                    <div style="font-size: 0.9rem; margin-top: 5px;">
                        æ­£åœ¨è¯»å–${availableVoices.length}ä¸ªå¯ç”¨è¯­éŸ³ï¼Œä½†æ²¡æœ‰ä¸­æ–‡ã€‚
                    </div>
                `;
                statusMsg.style.color = "red";

                // æ˜¾ç¤ºè§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœä¹‹å‰æ²¡æ˜¾ç¤ºè¿‡ï¼‰
                if (!document.getElementById('mobileVoiceFix')) {
                    checkMobileVoiceSupport();
                }

                // ä»ç„¶å°è¯•æ’­æ”¾ï¼Œä½†ç”¨æˆ·ä¼šå¬åˆ°å•éŸ³èŠ‚
                const utterance = new SpeechSynthesisUtterance(char);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.7;
                speechSynthesis.speak(utterance);
                return;
            }

            const utterance = new SpeechSynthesisUtterance(char);

            // **æ˜ç¡®æŒ‡å®šä¸­æ–‡è¯­éŸ³**
            utterance.voice = chineseVoices[0];
            console.log("âœ… ä½¿ç”¨ä¸­æ–‡è¯­éŸ³:", chineseVoices[0].name, chineseVoices[0].lang);

            // è®¾ç½®è¯­éŸ³å‚æ•°
            utterance.rate = 0.7;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;

            // äº‹ä»¶å¤„ç†
            utterance.onstart = () => {
                statusMsg.innerText = "ğŸ”Š æ­£åœ¨æœ—è¯»...";
                statusMsg.style.color = "#4ECDC4";
                playSound('click');
            };

            utterance.onend = () => {
                statusMsg.innerText = "âœ… æœ—è¯»å®Œæˆï¼";
                statusMsg.style.color = "#4ECDC4";
                setTimeout(() => {
                    statusMsg.innerText = "æ±‰å­—å·²åŠ è½½ï¼è¯·é€‰æ‹©ï¼šè§‚çœ‹ç¬”é¡º æˆ– è·Ÿç€ç»ƒä¹ ";
                    statusMsg.style.color = "#4ECDC4";
                }, 1500);
            };

            utterance.onerror = (event) => {
                console.error("è¯­éŸ³é”™è¯¯:", event);
                statusMsg.innerText = "âŒ è¯­éŸ³æ’­æ”¾å¤±è´¥";
                statusMsg.style.color = "red";
            };

            // å°è¯•æ’­æ”¾
            try {
                speechSynthesis.speak(utterance);
            } catch (error) {
                console.error("è¯­éŸ³é”™è¯¯:", error);
                statusMsg.innerText = "âŒ æ’­æ”¾å¤±è´¥ï¼š" + error.message;
                statusMsg.style.color = "red";
            }
        }

        // ç›‘å¬å›è½¦é”®
        document.getElementById('charInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                loadCharacter();
            }
        });

        // æ¸²æŸ“æ±‰å­—ç½‘æ ¼
        function renderCharGrid(category) {
            const charGrid = document.getElementById('charGrid');
            const chars = commonChars[category] || [];

            charGrid.innerHTML = '';

            chars.forEach(char => {
                const btn = document.createElement('button');
                btn.className = 'char-btn';
                btn.textContent = char;
                btn.onclick = () => {
                    document.getElementById('charInput').value = char;
                    loadCharacter();
                    playSound('click');
                };
                charGrid.appendChild(btn);
            });
        }

        // è®¾ç½®åˆ†ç±»æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
        function setupCategoryTabs() {
            const tabs = document.querySelectorAll('.category-tab');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    tabs.forEach(t => t.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
                    tab.classList.add('active');

                    const category = tab.dataset.category;
                    renderCharGrid(category);
                    playSound('click');
                });
            });
        }

        // Web Audio API éŸ³æ•ˆç³»ç»Ÿ
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                switch(type) {
                    case 'click':
                        oscillator.frequency.value = 800;
                        gainNode.gain.value = 0.1;
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.05);
                        break;
                    case 'success':
                        oscillator.frequency.value = 1000;
                        gainNode.gain.value = 0.2;
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.1);
                        setTimeout(() => {
                            const osc2 = audioContext.createOscillator();
                            const gain2 = audioContext.createGain();
                            osc2.connect(gain2);
                            gain2.connect(audioContext.destination);
                            osc2.frequency.value = 1200;
                            gain2.gain.value = 0.2;
                            osc2.start();
                            osc2.stop(audioContext.currentTime + 0.1);
                        }, 100);
                        break;
                    case 'error':
                        oscillator.frequency.value = 300;
                        gainNode.gain.value = 0.15;
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.2);
                        break;
                    case 'complete':
                        // æ’­æ”¾æˆåŠŸæ—‹å¾‹
                        const notes = [523.25, 659.25, 783.99]; // C, E, G
                        notes.forEach((freq, index) => {
                            setTimeout(() => {
                                const osc = audioContext.createOscillator();
                                const gain = audioContext.createGain();
                                osc.connect(gain);
                                gain.connect(audioContext.destination);
                                osc.frequency.value = freq;
                                gain.gain.value = 0.2;
                                osc.start();
                                osc.stop(audioContext.currentTime + 0.15);
                            }, index * 150);
                        });
                        break;
                }
            } catch (e) {
                console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
            }
        }

        // ä¸ºå…³é”®äº¤äº’æ·»åŠ éŸ³æ•ˆ
        document.addEventListener('DOMContentLoaded', () => {
            // ä¸ºæ‰€æœ‰æŒ‰é’®æ·»åŠ ç‚¹å‡»éŸ³æ•ˆ
            document.querySelectorAll('button').forEach(btn => {
                if (!btn.classList.contains('char-btn') && !btn.classList.contains('category-tab')) {
                    btn.addEventListener('click', () => playSound('click'));
                }
            });

            // ä¸ºæ±‰å­—æŒ‰é’®æ·»åŠ éŸ³æ•ˆ
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('char-btn')) {
                    playSound('click');
                }
            });
        });

        // åº†ç¥åŠ¨ç”»
        function showCelebration() {
            const overlay = document.getElementById('celebrationOverlay');
            const emojis = ['ğŸ‰', 'â­', 'âœ¨', 'ğŸŠ', 'ğŸ†', 'ğŸ’¯', 'ğŸ‘'];

            // æ¸…ç©ºè°ƒä»¥å‰çš„åŠ¨ç”»
            overlay.innerHTML = '';

            // åˆ›å»ºåº†ç¥è¡¨æƒ…
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'celebration-emoji';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.left = Math.random() * (window.innerWidth - 100) + 'px';
                    emoji.style.top = Math.random() * (window.innerHeight - 100) + 'px';
                    overlay.appendChild(emoji);

                    // 2ç§’åç§»é™¤
                    setTimeout(() => {
                        emoji.remove();
                    }, 2000);
                }, i * 100);
            }

            // åˆ›å»ºæ˜Ÿæ˜Ÿçˆ†ç‚¸æ•ˆæœ
            setTimeout(() => {
                for (let i = 0; i < 6; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.textContent = 'â˜…';
                    const angle = (i * 60) * Math.PI / 180;
                    const distance = 150;
                    star.style.left = (window.innerWidth / 2 + Math.cos(angle) * distance) + 'px';
                    star.style.top = (window.innerHeight / 2 + Math.sin(angle) * distance) + 'px';
                    overlay.appendChild(star);

                    setTimeout(() => {
                        star.remove();
                    }, 1500);
                }
            }, 500);
        }
    </script>
</body>
</html>